# Telegram-бот прогнозирования тренда валют  
**Версия 3.0**  



## Описание проекта  

Бот анализирует курсы иностранных валют к рублю и предсказывает, пойдёт курс вверх или вниз на следующий день.  
Исходные данные — официальные курсы Центрального банка РФ.  
Прогнозы формируются с помощью машинного обучения и сопровождаются пояснениями.


## Эволюция проекта  


### Версия 1.0
Первая рабочая версия бота.
Прогноз — искусственная заглушка: направление определяется чётностью текущей минуты (чётная → «вверх», нечётная → «вниз»).
Уверенность подаётся как 65–74%, чтобы имитировать работу модели.
Цель: минимальный MVP, проверка Telegram-интеграции.
Реализовано в одном файле. Не использует внешние данные и машинное обучение.

### Версия 2.0
Первый переход к реальным данным.
Бот подключается к API ЦБ РФ и получает курсы за два последних рабочих дня.
Прогноз строится по простому правилу: если курс сегодня выше, чем вчера — «вверх», иначе — «вниз».
Добавлена обработка ошибок (выходные, таймауты), кнопочная навигация, Markdown-форматирование.
Поддержка трёх валют: USD, EUR, CNY.
Код выделен в логические блоки: получение данных, прогноз, Telegram-обработчики.

### Версия 3.0
Финальная, полноценная версия.  
Архитектура переработана: модульность, кэширование, расширяемость.  
Основные улучшения:

- Поддержка всех валют из ЦБ РФ (более 30).  
- Единая модель машинного обучения для всех валют (ранее — по одной на валюту).  
- Модель: Random Forest с калибровкой вероятностей, обученная на четырёх признаках — изменение за день, скользящее среднее, волатильность, RSI.  
- Перед прогнозом выводится расширенная аналитика: текущий курс, динамика за 1/3/7 дней, уровень волатильности, статус RSI.  
- Команда `/how` — понятное объяснение расчётов: откуда данные, как работает модель, как интерпретировать уверенность.  
- Команда `/advice` — аналитические советы: «высокая волатильность — возможны резкие движения», «резкий рост — возможна коррекция».  
- Команда `/clear` — очистка последних сообщений бота (удобно для чистого чата).  
- Графики генерируются автоматически (PNG), поддерживают количество дней и диапазон дат.  
- Кэширование курсов — снижает нагрузку на API и ускоряет ответ.


## Как запустить  

1. Установите зависимости:  
   pip install -r requirements.txt

2. Получите токен у @BotFather и вставьте его в v3_ml_model/bot.py (переменная TOKEN).

3. Запустите бота:  
   cd v3_ml_model  
   python bot.py

4. В Telegram напишите боту:  
   /start  
   /predict USD  

При первом запуске данные закэшируются в папку cache/.


## Команды  

/start — приветствие и описание  
/predict USD 7 — прогноз для доллара (7 дней + ML + график)  
/predict EUR 01.12–18.1` — график евро за период  
/advice USD — аналитический совет по валюте  
/how — как считается прогноз?  
/clear — очистить последние сообщения бота  
/list — список всех валют  
/help — краткая справка   


## Прозрачность расчётов  

Все прогнозы сопровождаются пояснением:  
«чёткий сигнал (рост вчера, низкая волатильность)»  
или  
«неопределённо (противоречивые факторы)».  

Команда /how даёт полное описание:  
— откуда берутся данные,  
— какие признаки используются,  
— как работает модель,  
— как интерпретируется уверенность.  

Это делает систему объяснимой и понятной даже без технической подготовки.


## Технологии  

Python 3.9+  
python-telegram-bot  
scikit-learn  
matplotlib  
requests  
joblib  
numpy

Данные: API ЦБ РФ (https://cbr.ru/scripts/XML_daily.asp)  
Хостинг локальный

